<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Générateur de Prompt — Analyse Juridique</title>
  <style>
    :root{
      --bg:#f7f9fb; --bg-seo:#fff7ea; /* fond distinct en SEO */
      --card:#fff; --ink:#233044; --muted:#667085;
      --primary:#0066ff; --primary-600:#0055d4; --accent:#e8f0fe;
      --line:#e5e7eb; --soft:#f5f7fa; --ok:#079455; --warn:#b54708;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background:var(--bg); margin:0; padding:2rem; color:var(--ink);
      transition: background .25s ease;
    }
	/* Fond différent pour le bloc outil quand mode SEO */
body.seo-mode .container {
  background: #8ca3a8; /* même teinte que fond page SEO */
  border-color: #facc15;
}

    body.seo-mode{ background:var(--bg-seo); }
    h1{ text-align:center; margin:0 0 1.25rem; font-size:1.6rem; }
    .container{
      max-width: 980px; margin:auto; background:var(--card); padding:1.5rem;
      border-radius:var(--radius); box-shadow:0 8px 28px rgba(16,24,40,.08);
      border:1px solid var(--line);
    }
    .row{ display:grid; gap:1rem; grid-template-columns:1fr 1fr; }
    @media (max-width:900px){ .row{ grid-template-columns:1fr; } }
    label{ font-weight:600; display:block; margin:.75rem 0 .4rem; }
    .help{ color:var(--muted); font-size:.9rem; }
    input[type="text"], textarea, select{
      width:100%; padding:.8rem .9rem; border:1px solid #d0d5dd;
      border-radius:10px; background:#fff; color:var(--ink);
      outline:none; transition:border .2s, box-shadow .2s;
    }
    input[type="text"]:focus, textarea:focus, select:focus{
      border-color:var(--primary); box-shadow:0 0 0 3px rgba(0,102,255,.12);
    }
    textarea{ resize:vertical; min-height:120px; line-height:1.45; }
    .toolbar{
      display:flex; gap:.6rem; flex-wrap:wrap; align-items:center; margin:1rem 0;
    }
    .toolbar.bottom{ justify-content:flex-end; }
    button{
      background:var(--primary); color:#fff; border:none; padding:.75rem 1rem;
      border-radius:10px; cursor:pointer; font-weight:600; font-size:.95rem;
    }
    button:hover{ background:var(--primary-600); }
    .btn-ghost{ background:#fff; color:var(--ink); border:1px solid #d0d5dd; }
    .btn-ghost:hover{ border-color:var(--primary); color:var(--primary); }
    .btn-danger{ background:#ef4444; }
    .btn-danger:hover{ background:#dc2626; }
    .mode{
      display:flex; gap:.5rem; background:var(--soft); border:1px solid var(--line);
      padding:.5rem; border-radius:12px; margin-bottom:1rem; flex-wrap:wrap; justify-content:center;
    }
    .mode input{display:none}
    .seg{
      padding:.55rem .9rem; border-radius:10px; cursor:pointer; user-select:none;
      border:1px solid transparent; font-weight:600; color:#0f172a;
    }
    .seg.active{ background:#fff; border-color:#cbd5e1; box-shadow:0 1px 0 rgba(2,6,23,.06); }
    .badge{
      display:inline-block; padding:.25rem .5rem; border-radius:999px; font-size:.75rem; font-weight:700;
      border:1px solid #d0d5dd; margin-left:.5rem; color:#0f172a; background:#fff;
    }
    body.seo-mode .badge{ background:#fff3d4; border-color:#facc15; }
    .concurrent-block{
      border:1px solid var(--line); padding:1rem; margin-top:1rem;
      border-radius:10px; background:var(--soft);
    }
    #generatedPrompt{
      white-space:pre-wrap; background:var(--accent); padding:1rem;
      border-radius:10px; margin-top:1.25rem; border:1px solid #c7dafc;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    }
    .counter{ font-size:.82rem; color:var(--muted); text-align:right; margin-top:.25rem; }
    .bad{ color:var(--warn) }
    .good{ color:var(--ok) }
    .footer-note{ color:var(--muted); font-size:.86rem; margin-top:1rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Générateur de Prompt — Analyse Juridique
      <span id="modeBadge" class="badge">Mode : Réécriture</span>
    </h1>

    <!-- Mode selector -->
    <div class="mode" id="modeBox">
      <label class="seg active" id="seg-rewrite">
        <input type="radio" name="mode" value="rewrite" checked>
        Analyse & Réécriture Totale
      </label>
      <label class="seg" id="seg-seo">
        <input type="radio" name="mode" value="seo">
        Analyse Optimisation SEO (retouches)
      </label>
    </div>

    <div>
      <label for="articleTitle">Titre de l'article à analyser</label>
      <input type="text" id="articleTitle" placeholder="Entrez le titre ici..."/>
    </div>

    <label for="articleContent">Contenu de l'article à analyser</label>
    <textarea id="articleContent" rows="10" placeholder="Collez ici le contenu de votre article..."></textarea>
    <div class="counter" id="articleCounter">0 caractères</div>

    <div id="concurrentsContainer"></div>

    <!-- Toolbar du milieu : Ajouter concurrent (au-dessus des actions finales) + Reset -->
    <div class="toolbar">
      <button class="btn-ghost" id="btnAddCompetitor">+ Ajouter un article concurrent</button>
      <button class="btn-danger" id="btnReset">Réinitialiser</button>
    </div>

    <!-- Résultat -->
    <div id="generatedPrompt" aria-live="polite"></div>

    <!-- Toolbar tout en bas : Générer + Copier (derniers boutons) -->
    <div class="toolbar bottom">
      <button id="btnGenerate">Générer le Prompt</button>
      <button class="btn-ghost" id="btnCopy">Copier le Prompt</button>
    </div>

    <div class="footer-note">
      Astuce : remplis au minimum le <strong>titre</strong>, le <strong>contenu</strong> et ajoute 1–3 concurrents.
      L’outil s’auto-sauvegarde (navigateur uniquement).
    </div>
  </div>

  <script>
    // ====== State & Elements ======
    let competitorCount = 0;
    const els = {
      modeBox: document.getElementById('modeBox'),
      segRewrite: document.getElementById('seg-rewrite'),
      segSEO: document.getElementById('seg-seo'),
      modeBadge: document.getElementById('modeBadge'),
      articleTitle: document.getElementById('articleTitle'),
      articleContent: document.getElementById('articleContent'),
      articleCounter: document.getElementById('articleCounter'),
      concurrentsContainer: document.getElementById('concurrentsContainer'),
      btnAddCompetitor: document.getElementById('btnAddCompetitor'),
      btnGenerate: document.getElementById('btnGenerate'),
      btnCopy: document.getElementById('btnCopy'),
      btnReset: document.getElementById('btnReset'),
      output: document.getElementById('generatedPrompt'),
      body: document.body
    };

    // ====== Helpers ======
    const saveKey = 'legal_prompt_builder_v3';
    function saveDraft(){
      const data = {
        mode: getMode(),
        title: els.articleTitle.value,
        content: els.articleContent.value,
        competitors: collectCompetitors()
      };
      localStorage.setItem(saveKey, JSON.stringify(data));
    }
    function loadDraft(){
      const raw = localStorage.getItem(saveKey);
      if(!raw){ addCompetitor(); return; }
      try{
        const d = JSON.parse(raw);
        if(d.mode) setMode(d.mode); else setMode('rewrite');
        els.articleTitle.value = d.title || '';
        els.articleContent.value = d.content || '';
        if(Array.isArray(d.competitors) && d.competitors.length){
          d.competitors.forEach(c => addCompetitor(c.title, c.content));
        } else {
          addCompetitor();
        }
        updateCounter();
      }catch(e){ addCompetitor(); }
    }
    function resetAll(){
      localStorage.removeItem(saveKey);
      els.articleTitle.value = '';
      els.articleContent.value = '';
      els.output.textContent = '';
      els.concurrentsContainer.innerHTML = '';
      competitorCount = 0;
      addCompetitor();
      updateCounter();
      setMode('rewrite');
    }
    function updateCounter(){
      const n = els.articleContent.value.length;
      els.articleCounter.textContent = n + ' caractères';
      els.articleCounter.className = 'counter ' + (n < 400 ? 'bad' : 'good');
    }
    function getMode(){
      return document.querySelector('input[name="mode"]:checked')?.value || 'rewrite';
    }
    function setMode(mode){
  const rewrite = mode === 'rewrite';
  document.querySelector('input[name="mode"][value="rewrite"]').checked = rewrite;
  document.querySelector('input[name="mode"][value="seo"]').checked = !rewrite;
  els.segRewrite.classList.toggle('active', rewrite);
  els.segSEO.classList.toggle('active', !rewrite);
  els.modeBadge.textContent = 'Mode : ' + (rewrite ? 'Réécriture' : 'Optimisation SEO');
  els.body.classList.toggle('seo-mode', !rewrite); // fond distinct SEO
}

    // ====== Competitors ======
    function addCompetitor(prefillTitle='', prefillContent=''){
      competitorCount++;
      const id = competitorCount;
      const block = document.createElement('div');
      block.className = 'concurrent-block';
      block.dataset.cid = id;
      block.innerHTML = `
        <div class="row">
          <div>
            <label for="concurrentTitle${id}">Titre de l'article concurrent ${id}</label>
            <input type="text" id="concurrentTitle${id}" placeholder="Titre de l'article concurrent..." value="${escapeHtml(prefillTitle)}"/>
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn-ghost" type="button" data-remove="${id}">Supprimer ce concurrent</button>
          </div>
        </div>
        <label for="concurrentContent${id}">Contenu de l'article concurrent ${id}</label>
        <textarea id="concurrentContent${id}" rows="6" placeholder="Collez ici le contenu...">${escapeHtml(prefillContent)}</textarea>
      `;
      els.concurrentsContainer.appendChild(block);
      // bind remove
      block.querySelector(`[data-remove="${id}"]`).addEventListener('click', ()=>{
        block.remove(); saveDraft();
      });
      // bind autosave
      block.querySelector(`#concurrentTitle${id}`).addEventListener('input', saveDraft);
      block.querySelector(`#concurrentContent${id}`).addEventListener('input', saveDraft);
    }
    function collectCompetitors(){
      const arr = [];
      els.concurrentsContainer.querySelectorAll('.concurrent-block').forEach(block=>{
        const id = block.dataset.cid;
        const t = block.querySelector(`#concurrentTitle${id}`)?.value?.trim() || '';
        const c = block.querySelector(`#concurrentContent${id}`)?.value?.trim() || '';
        if(t || c){ arr.push({title:t, content:c}); }
      });
      return arr;
    }
    function buildCompetitorsText(){
      const comps = collectCompetitors();
      if(!comps.length) return '(Aucun concurrent fourni)';
      return comps.map((c, i)=> {
        const idx = i+1;
        return `---\nArticle concurrent ${idx}\nTitre : ${c.title || '(sans titre)'}\nContenu :\n${c.content || '(vide)'}`;
      }).join('\n\n');
    }

    // ====== Templates ======
    function tmplRewrite({title, content, comps}){
return `✅ PROMPT — ANALYSE & RÉÉCRITURE TOTALE (ARTICLE JURIDIQUE POUR JUSTICIABLE)

Tu agis comme un expert SEO + juriste. Objectifs :
• Évaluer si le contenu est vraiment helpful pour un justiciable
• Identifier toutes les lacunes juridiques et structurelles
• Proposer un axe éditorial clair, une nouvelle structure Hn optimisée
• Produire une base solide pour une RÉÉCRITURE TOTALE

________________________________________
🔍 Contenu à analyser
Titre : ${title || '(sans titre)'}
Contenu :
${content || '(vide)'}

________________________________________
📎 Articles concurrents à dépasser
${comps}
→ Objectif : faire mieux en structure, clarté, richesse juridique et SEO.

________________________________________
⚖️ Analyse rapide (bullet points actionnables)
• Intent actuel : Low / Medium / High
• Public cible : identifié ? Oui / Non
• Ton/registre : Trop vague / Trop technique / Équilibré
• CTA vers un avocat : Faible / Moyen / Fort

________________________________________
🔎 Constat — Lacunes & points faibles
• Notions juridiques manquantes ou survolées
• Acteurs/juridictions absents (tribunal, juge, administration, avocat)
• Procédures concrètes, recours, délais, risques (ce qui manque)
• Vocabulaire juridique à vulgariser
• Liens internes / ressources / CTA à prévoir

________________________________________
🎯 Axe éditorial recommandé
• Angle central (orienté justiciable, incitatif, clair)
• Proposition de titre H1 remanié (2 variantes)

________________________________________
📑 Nouvelle table des matières optimisée (H1/H2)
• Définitions et bases juridiques
• Situations & cas concrets
• Démarches, procédures, délais
• Recours & juridictions compétentes
• Rôle de l’avocat (quand & pourquoi consulter)
• Conseils pratiques + CTA internes

________________________________________
🔑 Mots-clés SEO (8–12)
• Principaux + secondaires (alignés sur l’intention de recherche)

________________________________________
✅ Checklist “vraiment helpful”
• Problèmes concrets des justiciables traités
• Distinction cas simples vs conflictuels
• Procédures + juridictions + délais mentionnés
• Droits/obligations en langage clair
• Exemples/cas pratiques
• Rôle de l’avocat valorisé quand pertinent
• Liens internes utiles (annuaire avocat + articles connexes)
`;
    }

    function tmplSEO({title, content, comps}){
return `✅ PROMPT — ANALYSE OPTIMISATION SEO (RETOUCHES RAPIDES, SANS RÉÉCRITURE TOTALE)

Tu es expert SEO + juriste. Objectif : lister UNIQUEMENT les retouches essentielles et rapides
pour que l’article surpasse les concurrents, sans tout réécrire.
Si la réécriture totale est indispensable, commence par : "⚠️ À réécrire totalement" (avec 3 raisons).

________________________________________
🔍 Article à optimiser
Titre : ${title || '(sans titre)'}
Contenu :
${content || '(vide)'}

________________________________________
📎 Concurrents à dépasser (référence)
${comps}

________________________________________
🎯 Donne une liste courte (max 10 actions), ultra priorisée :
• Titres Hn à ajuster / renommer (liste précise)
• Paragraphes à ajouter/supprimer/resserrer (sections ciblées)
• Notions juridiques à intégrer (mots-clés juridiques utiles)
• Procédures/recours/délais manquants à insérer
• CTA & liens internes indispensables (annuaire avocat + 1–2 articles)
• Schéma d’ancre et mots-clés à placer (3–5 requêtes)
• Exemples/cas concrets à ajouter (1–2)
• Nettoyage style/ton : simplifier, vulgariser, raccourcir où nécessaire

Format attendu :
1) 🔧 Changement Hn : …
2) ➕ Ajouter paragraphe : …
3) ✂️ Supprimer/condense : …
4) ⚖️ Procédure/recours à inclure : …
5) 📎 Liens internes/CTA : …
6) 🔑 Mots-clés & emplacement : …
7) 🧩 Exemples/cas : …
8) ✍️ Ton & clarté : …

Concentre-toi UNIQUEMENT sur des retouches ciblées. Pas de table des matières.
`;
    }

    // ====== Prompt generation ======
    function generatePrompt(){
      const mode = getMode();
      const title = els.articleTitle.value.trim();
      const content = els.articleContent.value.trim();

      if(!title) toast('Ajoute au moins un titre pour cadrer l’analyse.');
      if(content.length < 200) toast('Le contenu est très court : vise ≥ 400 caractères pour une analyse pertinente.');

      const comps = buildCompetitorsText();
      const payload = { title, content, comps };
      const out = (mode === 'seo') ? tmplSEO(payload) : tmplRewrite(payload);
      els.output.textContent = out;
      els.output.scrollIntoView({behavior:'smooth', block:'start'});
      saveDraft();
    }

    // ====== UI bits ======
    function toast(msg){ console.log('[info]', msg); }
    function escapeHtml(str=''){
      return str.replace(/[&<>"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
    }

    // ====== Events ======
    els.btnAddCompetitor.addEventListener('click', ()=>{ addCompetitor(); saveDraft(); });
    els.btnGenerate.addEventListener('click', generatePrompt);
    els.btnCopy.addEventListener('click', ()=>{
      const txt = els.output.textContent.trim();
      if(!txt) return;
      navigator.clipboard.writeText(txt).then(
        ()=>alert('✅ Prompt copié dans le presse-papiers !'),
        ()=>alert('❌ Échec de la copie.')
      );
    });
    els.btnReset.addEventListener('click', ()=>{
      if(confirm('Tout effacer et réinitialiser ?')) resetAll();
    });
    els.articleContent.addEventListener('input', ()=>{ updateCounter(); saveDraft(); });
    els.articleTitle.addEventListener('input', saveDraft);
    els.modeBox.addEventListener('click', (e)=>{
      const label = e.target.closest('.seg');
      if(!label) return;
      const mode = (label===els.segRewrite) ? 'rewrite' : 'seo';
      setMode(mode);
      saveDraft();
    });

    // ====== Init ======
    (function init(){
      loadDraft();                 // try load draft
      if(!els.concurrentsContainer.children.length){ addCompetitor(); }
      updateCounter();
    })();
  </script>
</body>
</html>
